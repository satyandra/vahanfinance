/**
 * Copyright (c) 2013 - 2019 fusionCSS. All rights reserved.
 * @link http://fusionCSS.com
 * @version 3.2.0
 */
$.fn.extend({makeDragContainer:function(x){return(x=x||{}).dragMarkerClass=x.dragMarkerClass||"dragMarker",x.dragItemClass=x.dragItemClass||"dragItem",x.dragDraggingClass=x.dragDraggingClass||"dragDragging",x.disableDragInto=x.disableDragInto||!1,x.dragTopOnly=x.dragTopOnly||!1,this.each(function(){var h,v,m,o,C,w=$(this),D=null,y=0,b=0,I=null,M=null,a=null,r=null,O=!1;if(w.find("."+x.dragMarkerClass).length||w.append('<div class="'+x.dragMarkerClass+'" style="display: none;"></div>'),x.dragTopOnly){var e=w.find("ul");e.length||(e=w.find("ol")),e.first().children().addClass(x.dragItemClass)}else w.find("li").addClass(x.dragItemClass);function t(e){var t=$(e.target),o=t.closest("."+x.dragItemClass),a=w.offset();if(!t.closest("a").length&&o.length){m=e.touches&&e.touches.length?(v=e.touches[0].pageX,e.touches[0].pageY):(v=e.pageX,e.pageY),y=v-o.offset().left,b=m-o.offset().top,v-=a.left,m-=a.top,O&&(v+=w.scrollLeft(),m+=w.scrollTop());var r={dragging:o,eventTarget:t,allowDrag:!0};w.trigger("draggingStart",r),r.allowDrag&&(e.preventDefault(),(D=o).addClass(x.dragDraggingClass),I=M=null,h=w.find("."+x.dragMarkerClass),x.copyFunction?x.copyFunction(h,D):h.html(D.html()),h.css("left",v-y+"px").css("top",m-b+"px").width(D.outerWidth(!0)),w.on("mousemove",s).on("touchmove",s).on("mouseup",k).on("touchend",k))}}function n(){r.scrollTop(r.scrollTop()+o),s(C)}function P(e,t){t?(a&&e[0]!=r[0]&&T(),r=e,o=2*t,null===a&&(a=window.setInterval(n,15))):a&&T()}function T(){null!==a&&(window.clearInterval(a),a=null)}function s(e){var t,o,a,r,n=w.offset(),s=w[0].getBoundingClientRect();if(e.preventDefault(),e.stopPropagation(),r=(C=e).touches&&e.touches.length?(t=e.touches[0].pageX,o=e.touches[0].pageY,a=e.touches[0].clientX,e.touches[0].clientY):(t=e.pageX,o=e.pageY,a=e.clientX,e.clientY),t-=n.left,o-=n.top,O&&(t+=w.scrollLeft(),o+=w.scrollTop()),a<=Math.ceil(s.left+2)||a>=Math.floor(s.right-2)||r<=Math.ceil(s.top+2)||r>=Math.floor(s.bottom-2))k(e);else{h.css("left",t-y+"px").css("top",o-b+"px"),h.hide();var l=document.elementFromPoint(a,r);if((l=$(l).closest("."+x.dragItemClass)).length&&!l.hasClass(x.dragDraggingClass)&&!l.closest("."+x.dragDraggingClass).length){var g=Math.abs(v-t),i=Math.abs(m-o),d=l[0].getBoundingClientRect(),c=!0;(x.disableDragInto||x.disableDropOn&&"true"===l.attr(x.disableDropOn))&&(c=!1);var f={dragging:D,dropTarget:l,dropPosition:"on",allowPosition:!0};if(i<g){var p=c?d.width/3:d.width/2;a>d.right-p?(D.css("opacity",1),M="after",l.next()[0]!==D[0]&&(w.trigger("draggingOver",f),f.allowPosition&&(D.remove(),D.insertAfter(l),v=t,m=o,I=l))):a<d.left+p?(D.css("opacity",1),M="before",l.prev()[0]!==D[0]&&(w.trigger("draggingOver",f),f.allowPosition&&(D.remove(),D.insertBefore(l),v=t,m=o,I=l))):!c||l[0]===D[0]&&"on"===M||(w.trigger("draggingOver",f),f.allowPosition&&(M="on",D.css("opacity",.2),I=l))}else{var u=c?d.height/3:d.height/2;r>d.bottom-u?(D.css("opacity",1),M="after",l.next()[0]!==D[0]&&(w.trigger("draggingOver",f),f.allowPosition&&(D.remove(),D.insertAfter(l),v=t,m=o,I=l))):r<d.top+u?(D.css("opacity",1),M="before",l.prev()[0]!==D[0]&&(w.trigger("draggingOver",f),f.allowPosition&&(D.remove(),D.insertBefore(l),v=t,m=o,I=l))):!c||l[0]===D[0]&&"on"===M||(w.trigger("draggingOver",f),f.allowPosition&&(M="on",D.css("opacity",.2),I=l))}}h.show(),(s.top<0||s.bottom>$(window).height())&&(r<30||r>$(window).height()-30)?P($(window),r<30?-1:1):r<s.top+30?P(w,-1):r>s.bottom-30?P(w,1):T()}}function k(e){if(D){D.css("opacity",1),e.preventDefault(),w.off("mousemove",s).off("touchmove",s).off("mouseup",k).off("touchend",k),T(),h.hide(),D.removeClass(x.dragDraggingClass);var t={dragging:D,dropTarget:null===M?null:I,dropPosition:M};D=null,w.trigger("draggingEnd",t)}}w.find("li").parent().parent()[0]===w[0]&&(O=!0),w.on("mousedown",t).on("touchstart",t),$(document).on("keyup",function(e){D&&"Escape"===e.key&&(k(e),e.preventDefault())})})}});